{% extends "layout.html" %}
{% block title %}Belanja Produk - JElectro{% endblock %}

{% block content %}

{# Pesan sukses #}
{% if session.beli_success %}
<div class="alert alert-success text-center">
    {{ session.beli_success }}
</div>
{% set beli_success_msg = session.pop('beli_success') %}
{% endif %}

{# Pesan error #}
{% if session.beli_error %}
<div class="alert alert-danger text-center">
    {{ session.beli_error }}
</div>
{% set beli_error_msg = session.pop('beli_error') %}
{% endif %}

<div class="container py-4">
    <h2 class="text-center mb-4 fw-bold">
        <i class="bi bi-shop"></i> Katalog Produk
    </h2>

    {% set kategori_list = {} %}

    {# Kelompokkan produk per kategori #}
    {% for p in produk %}
        {% if p.nama_kategori not in kategori_list %}
            {% set _ = kategori_list.update({p.nama_kategori: []}) %}
        {% endif %}
        {% set _ = kategori_list[p.nama_kategori].append(p) %}
    {% endfor %}

    {# Tampilkan produk per kategori #}
    {% for kategori, items in kategori_list.items() %}
        <div class="mb-5">
            <h4 class="mb-3 text-primary fw-semibold">
                <i class="bi bi-tags"></i> {{ kategori }}
            </h4>

            <div class="row g-4">
                {% for p in items %}
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body d-flex flex-column">
                            <h5 class="fw-bold">{{ p.nama_produk }}</h5>

                            <p class="mb-1">
                                <strong>Harga:</strong>
                                <span class="text-success">
                                    Rp {{ "{:,}".format(p.harga).replace(",", ".") }}
                                </span>
                            </p>

                            <p class="mb-3">
                                <strong>Stok:</strong>
                                {% if p.stok > 0 %}
                                    <span class="text-success">{{ p.stok }}</span>
                                {% else %}
                                    <span class="text-danger">Habis</span>
                                {% endif %}
                            </p>

                            <div class="mt-auto">
                                {% if p.stok > 0 %}
                                    <a href="{{ url_for('checkout', id_produk=p.id_produk) }}"
                                       class="btn btn-success w-100">
                                        <i class="bi bi-cart-plus"></i> Beli
                                    </a>
                                {% else %}
                                    <button class="btn btn-secondary w-100" disabled>
                                        Stok Habis
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}

</div>
{% endblock %}
